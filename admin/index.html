<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Test ADMIN frise chronologique</title>
		<!-- JQuery -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
		<!-- Latest compiled and minified bootstrap CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
		<!-- Optional theme bootstrap css-->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
		<!-- Latest compiled and minified JavaScript for bootsrap -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
		<!-- Angular -->
		<script src= "http://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>
		<!-- AngularUI -->
		<script src= "ui-bootstrap-0.13.4.min.js"></script>
	</head>
	
<body>

	<hr />

	<button class="btn btn-primary" onclick='$.ajax({url: "../update.php",context: document.body,success: function(){alert("Base mise à jour !");}});'>Mettre à jour la base de données</button> 

	<hr />
	
	<div ng-app="myApp" ng-controller="DisplayEvents">
	
		Liste des évènements en BDD :
		<table class="table table-striped table-hover table-condensed">
			<thead>
				<td>ID</td>
				<td>Période parente</td>
				<td>Date</td>
				<td>Nom</td>
				<td>Image</td>
			</thead>
			<tbody>
			<tr ng-repeat="x in events">
				<td>{{ x.ID }}</td>
				<td>
					<div ng-controller="AvailablePeriodsDropdownCtrl">
						<tt>Option choisie = {{data.selectedOption}}</tt><br/>
						<form name="myForm">
							<select name="parent_periods_selector2" id="parent_periods_selector2" ng-options="data.PeriodName for data in data.availableOptions track by data.PeriodName" ng-model="data.parent_periods_selector2"></select>
						</form>
					</div>
				</td>
				<td>{{ x.Date }}</td>
				<td>{{ x.Name }}</td>
				<td>
					<button type="button" class="btn btn-default" ng-model="singleModel" ng-click="open()">Editer l'image</button>
				</td>
			</tr>
			</tbody>
		</table>

	</div>

	<script>
	var app = angular.module('myApp', ['ui.bootstrap']);
	
	app.controller('DisplayEvents', function($scope, $http) {
		$http.get("http://dev.adriencarpentier.com/frise-histoire/admin/ajax_displayevents.php")
		.success(function (response) {$scope.events = response.records;});	
	});
	
	app.controller('AvailablePeriodsDropdownCtrl', function($scope, $http) {
		$http.get("http://dev.adriencarpentier.com/frise-histoire/admin/ajax_availableperiods.php?parent_period_id=6") // TEST - parent_period_id à rendre dynamique
		.success(function (response) {
			$scope.data = {
				availableOptions: response.periods,
				selectedOption: response.parent_period_name //This sets the default value of the select in the ui
			};
		});
	});
	
	</script>

</body>
</html>